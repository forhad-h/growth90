<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Learning Path - Growth90</title>
    <script>
        // Simple test to check IndexedDB data
        async function testIndexedDB() {
            console.log('üîç Testing IndexedDB access...');
            
            try {
                const request = indexedDB.open('Growth90DB', 1);
                
                request.onsuccess = (event) => {
                    const db = event.target.result;
                    console.log('‚úÖ Database opened successfully');
                    
                    // Check if learningPaths store exists
                    if (db.objectStoreNames.contains('learningPaths')) {
                        console.log('‚úÖ learningPaths store exists');
                        
                        const transaction = db.transaction(['learningPaths'], 'readonly');
                        const store = transaction.objectStore('learningPaths');
                        const getAllRequest = store.getAll();
                        
                        getAllRequest.onsuccess = () => {
                            const allPaths = getAllRequest.result;
                            console.log('üìö All learning paths:', allPaths);
                            
                            allPaths.forEach((path, index) => {
                                console.log(`Path ${index + 1}:`, {
                                    id: path.id,
                                    userId: path.userId,
                                    title: path.title,
                                    hasCurriculum: Array.isArray(path.curriculum),
                                    curriculumLength: path.curriculum ? path.curriculum.length : 0,
                                    firstDay: path.curriculum && path.curriculum.length > 0 ? path.curriculum[0] : null
                                });
                            });
                            
                            // Try to find a path with curriculum
                            const pathWithCurriculum = allPaths.find(p => p.curriculum && Array.isArray(p.curriculum) && p.curriculum.length > 0);
                            if (pathWithCurriculum) {
                                console.log('üéØ Found path with curriculum:', pathWithCurriculum);
                                displayCurriculumSample(pathWithCurriculum);
                            } else {
                                console.log('‚ùå No paths with curriculum found');
                            }
                        };
                        
                        getAllRequest.onerror = () => {
                            console.error('‚ùå Error getting all learning paths:', getAllRequest.error);
                        };
                    } else {
                        console.log('‚ùå learningPaths store does not exist');
                    }
                };
                
                request.onerror = () => {
                    console.error('‚ùå Error opening database:', request.error);
                };
            } catch (error) {
                console.error('‚ùå Error accessing IndexedDB:', error);
            }
        }
        
        function displayCurriculumSample(learningPath) {
            const container = document.getElementById('curriculum-sample');
            if (!container) return;
            
            const first10Days = learningPath.curriculum.slice(0, 10);
            
            const html = `
                <h2>Sample Curriculum from ${learningPath.title}</h2>
                <p>Total days: ${learningPath.curriculum.length}</p>
                <div style="background: #f5f5f5; padding: 1rem; border-radius: 8px;">
                    ${first10Days.map(day => `
                        <div style="margin-bottom: 0.5rem; padding: 0.5rem; background: white; border-radius: 4px;">
                            <strong>Day ${day.day}:</strong> ${day.primary_learning_objective || day.title || 'No title'}
                            ${day.description ? `<br><small>${day.description}</small>` : ''}
                        </div>
                    `).join('')}
                    ${learningPath.curriculum.length > 10 ? '<p>... and more</p>' : ''}
                </div>
            `;
            
            container.innerHTML = html;
        }
        
        // Run test when page loads
        window.addEventListener('load', testIndexedDB);
    </script>
</head>
<body>
    <h1>Learning Path Debug Test</h1>
    <p>Check the console for debug information about IndexedDB data.</p>
    <div id="curriculum-sample"></div>
</body>
</html>
